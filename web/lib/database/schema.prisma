generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views", "multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public", "web"]
}

model Draft {
  id              Int      @id @default(autoincrement())
  title           String
  description     String
  image           String
  users           String[]
  isPrivate       Boolean  @default(true)
  isOnchain       Boolean  @default(false)
  updatedAt       DateTime @updatedAt
  createdAt       DateTime @default(now())
  flowId          String
  isFlow          Boolean  @default(false)
  transactionHash String?

  flow Grant @relation(fields: [flowId], references: [id])

  @@index([isPrivate], map: "isPrivate_1")
  @@index([isOnchain], map: "isOnchain_1")
  @@index([flowId], map: "flowId_1")
  @@index([createdAt], map: "createdAt_1")
  @@map("Draft")
  @@schema("web")
}

view Grant {
  id               String  @id
  recipient        String  @unique
  recipientId      String
  isTopLevel       Int
  isFlow           Int
  title            String
  description      String
  image            String
  tagline          String?
  url              String?
  isRemoved        Int
  blockNumber      String
  parent           String
  votesCount       String
  monthlyFlowRate  String
  totalEarned      String
  claimableBalance String
  tcr              String
  arbitrator       String
  erc20            String

  flow         Grant         @relation("Subgrants", fields: [parent], references: [recipient])
  subgrants    Grant[]       @relation("Subgrants")
  drafts       Draft[]
  applications Application[]

  @@map("Grant")
  @@schema("public")
}

view Vote {
  id          String @id
  contract    String
  recipientId String
  tokenId     String
  bps         Int
  voter       String
  blockNumber String
  isStale     Int
  votesCount  String

  @@schema("public")
}

view PonderMeta {
  key   String @id
  value String

  @@map("_ponder_meta")
  @@schema("public")
}

view Application {
  id          String @id
  flowId      String
  recipient   String
  submitter   String
  title       String
  description String
  image       String
  tagline     String
  url         String
  isFlow      Int
  blockNumber String
  status      Int
  updatedAt   Int

  flow Grant? @relation(fields: [flowId], references: [id])

  @@map("Application")
  @@schema("public")
}
